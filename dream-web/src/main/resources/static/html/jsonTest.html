<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
  </style>
</head>
<body>
</body>
<script src="../js/jquery.min.js"></script>
<script>
  $(function () {
    doSomething();
  });

  var C = {};

C.LEFT_BRACE      = 0x7B;             //左大括号
C.RIGHT_BRACE     = 0x7D;             //右大括号
C.LEFT_BRACKET    = 0x28;             //左括号
C.RIGHT_BRACKET   = 0x29;             //右括号
C.COLON           = 0x3A;             //冒号
C.COMMA           = 0x2C;             //逗号
C.QUOTES          = 0x27;             //单引号
C.DOUBLE_QUOTES   = 0x22;             //双引号

C.BACK_SLASH =      "\\".charCodeAt(0);
C.FORWARD_SLASH =   "\/".charCodeAt(0);
C.BACKSPACE =       "\b".charCodeAt(0);
C.FORM_FEED =       "\f".charCodeAt(0);
C.NEWLINE =         "\n".charCodeAt(0);
C.CARRIAGE_RETURN = "\r".charCodeAt(0);
C.TAB =             "\t".charCodeAt(0);
C.BLANK =           0X20;



C.LEFT_BRACE                = "{";             //左大括号
C.RIGHT_BRACE               = "}";             //右大括号
C.LEFT_BRACKET              = "[";             //左括号
C.RIGHT_BRACKET             = "]";             //右括号
C.COLON                     = ":";             //冒号
C.COMMA                     = ",";             //逗号
C.QUOTES                    = "'";             //单引号
C.DOUBLE_QUOTES             = "\"";            //双引号
C.LEFT_DOUBLE_QUOTES        = "l";             //左双引号
C.RIGHT_DOUBLE_QUOTES       = "r";             //右双引号


C.BACK_SLASH =      "\\";
C.FORWARD_SLASH =   "\/";
C.BACKSPACE =       "\b";
C.FORM_FEED =       "\f";
C.NEWLINE =         "\n";
C.CARRIAGE_RETURN = "\r";
C.TAB =             "\t";
C.BLANK =           " ";

C.TRUE          = "TRUE";
C.FALSE         = "FALSE";
C.NULL          = "NULL";
C.STRING        = "STRING";
C.NUMBER        = "NUMBER";
C.OBJECT        = "OBJECT";
C.ARRAY         = "ARRAY";

  var stack = new Array();

  function doSomething(){
    console.log("start");
    var arr = json.split("");
    console.log(arr.length);
    parse(json);
  }
  function getBlank(deep){
    var blank = "";
    var stand = "    ";
    for(var i=0;i<deep;i++){
      blank += stand;
    }
    return blank;
  }

  var parser = {};
  var result = new Array();
  var state;
  var stateColon = 0;
  var stateDoubleQuote = null;//空,左双引号,右双引号
  var deep = 0;
  var text = "";
  function parse(str){
    for(var i =0;i<str.length;){
      var ele = str.charAt(i);
      if(ele == C.LEFT_BRACE){//左大括号
        if(state == C.LEFT_BRACE){
            //如果已经是左大括号的状态,表示当前这个大括号是内容
        }else{
          deep++;
          state = C.LEFT_BRACE;
          text = text + C.LEFT_BRACE + C.NEWLINE + getBlank(deep);
        }
      }else if(ele== C.RIGHT_BRACE){//右大括号
        deep--;
        state = C.RIGHT_BRACE;
        text = text + C.NEWLINE + getBlank(deep) + C.RIGHT_BRACE ;
      }else if(ele == C.COLON){//冒号
        stateColon = C.COLON;
        text = text + C.COLON;
      }else if(ele == C.COMMA){//逗号
        if(stateDoubleQuote == C.RIGHT_DOUBLE_QUOTES || stateDoubleQuote == null){
          //如果当前是右括号状态,那么新遇见的逗号就是换行的标志
          state = C.COMMA;
          text = text + C.COMMA + C.NEWLINE + getBlank(deep);
        }else{
          //
          text = text + C.COMMA;
        }
      }else if(ele == C.DOUBLE_QUOTES){//双引号
        if(stateDoubleQuote == null){
          stateDoubleQuote = C.LEFT_DOUBLE_QUOTES;
        }else if(stateDoubleQuote == C.LEFT_DOUBLE_QUOTES){
          stateDoubleQuote = C.RIGHT_DOUBLE_QUOTES;
        }else{
          stateDoubleQuote = C.LEFT_DOUBLE_QUOTES;
        }
        text = text + C.DOUBLE_QUOTES;
      }else if(ele == C.NEWLINE){//换行
        continue;
      }else{
        if(ele == C.TAB 
            || ele == C.BLANK){

          if(state == C.LEFT_BRACE
              || state == C.COMMA
              || stateColon == C.COLON){
            continue;
          }
          if(stateDoubleQuote == null || stateDoubleQuote == C.RIGHT_DOUBLE_QUOTES){
            continue;
          }
        }
        text = text + ele;
      }
      i++;
    }
    console.log("----result---")
    console.log(text);
  }

    /**
   {"obj":{"name":"xiaoming","age":12,"isBeijing":false,"isTianjin":false,"data":null,"salary":12.434},"pName":"hebei","add":123,"objA":{"name":"xmA","ageA":234,"bjA":false,"tjA":true,"dataA":null,"salaA":434.222},"oA":"xian","oData":null,"oo":323}
      **/
  var  json = "{\"ob,j\":{\"nam,e\":\"xia:omi,ng\",\"age\":12,\"isBeijing\":false,\"isTianjin\":false,\"data\":null,\"salary\":12.434},\"pName\":\"hebei\",\"add\":123,\"objA\":{\"name\":\"xmA\",\"ageA\":234,\"bjA\":false,\"tjA\":true,\"dataA\":null,\"salaA\":434.222},\"oA\":\"xian\",\"oData\":null,\"oo\":323}";


</script>
</html>